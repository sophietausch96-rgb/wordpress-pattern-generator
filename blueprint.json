{
  "preferredVersions": {
    "php": "8.2",
    "wp": "latest"
  },
  "features": {
    "networking": true
  },
  "steps": [
    { "step": "login", "username": "admin", "password": "password" },

    {
      "step": "writeFile",
      "path": "/wp-content/plugins/ai-patterns/ai-patterns.php",
      "data": "<?php\n/**\n * Plugin Name: AI Patterns\n * Description: Registriert Gutenberg Block Patterns aus AI-HTML (per REST)\n * Version: 0.3.0\n */\n\nif (!defined('ABSPATH')) { exit; }\n\nadd_action('admin_menu', function(){\n  add_menu_page('AI Pattern Maker','AI Pattern Maker','manage_options','ai-patterns','ai_patterns_admin_page','dashicons-art',58);\n});\n\nfunction ai_patterns_admin_page(){\n  $nonce = wp_create_nonce('wp_rest');\n  $rest  = esc_url_raw( rest_url('ai-patterns/v1/create') );\n  echo '<div class=\\\"wrap\\\"><h1>AI Pattern Maker</h1>';\n  echo '<p>Hier kannst du Gutenberg-HTML einfügen (<!-- wp:... -->). Nach Speichern erscheint es im Inserter unter <b>AI Patterns</b>.</p>';\n  echo '<textarea id=\\\"ai_html\\\" rows=\\\"10\\\" style=\\\"width:100%\\\" placeholder=\\\"<!-- wp:group --><!-- /wp:group -->\\\"></textarea><br><br>';\n  echo '<button id=\\\"ai_save\\\" class=\\\"button button-primary\\\">Als Pattern registrieren</button> ';\n  echo '<span id=\\\"ai_status\\\" style=\\\"margin-left:10px\\\"></span>';\n  echo '<script>window.AI_PATTERNS={nonce:". $nonce .", endpoint:\\\"'. $rest .'\\\"};</script>';\n  echo '</div>';\n}\n\nadd_action('admin_enqueue_scripts', function($hook){\n  if($hook !== 'toplevel_page_ai-patterns'){ return; }\n  wp_add_inline_script('jquery', \"(function(){var b=document.getElementById('ai_save');var t=document.getElementById('ai_html');var s=document.getElementById('ai_status');function n(m){s.textContent=m;} b&&b.addEventListener('click', async function(){var html=(t.value||'').trim(); if(!html||html.indexOf('<!-- wp:')===-1){ alert('Bitte gültiges Gutenberg-Block-HTML einfügen.'); return; } n('Speichere…'); try { var res = await fetch(window.AI_PATTERNS.endpoint,{method:'POST',headers:{'Content-Type':'application/json','X-WP-Nonce':window.AI_PATTERNS.nonce},body:JSON.stringify({title:'AI Pattern – Entwurf', content:html})}); if(!res.ok){ throw new Error('Fehler: '+res.status); } n('Gespeichert! Öffne im Editor den Block-Inserter → AI Patterns.'); } catch(err){ console.error(err); n('Fehler: '+err.message); } });})();\");\n});\n\nadd_action('rest_api_init', function(){\n  register_rest_route('ai-patterns/v1','/create',[\n    'methods'  => 'POST',\n    'permission_callback' => function(){ return current_user_can('edit_posts'); },\n    'args' => [ 'title'=>['required'=>true,'type'=>'string'], 'content'=>['required'=>true,'type'=>'string'] ],\n    'callback' => function( WP_REST_Request $req ){\n      $title = sanitize_text_field($req->get_param('title'));\n      $content = $req->get_param('content');\n      register_block_pattern_category('ai-patterns', ['label' => 'AI Patterns']);\n      $slug = 'ai-pattern-' . wp_generate_password(8,false,false);\n      register_block_pattern($slug, [ 'title'=>$title, 'content'=>$content, 'categories'=>['ai-patterns'] ]);\n      return new WP_REST_Response(['ok'=>true,'slug'=>$slug], 200);\n    }\n  ]);\n});\n"
    },

    { "step": "activatePlugin", "plugin": "ai-patterns/ai-patterns.php" },

    {
      "step": "installTheme",
      "themeZipFile": "https://downloads.wordpress.org/theme/twentytwentyfour.latest-stable.zip"
    },
    { "step": "activateTheme", "theme": "twentytwentyfour" },

    { "step": "navigate", "url": "/wp-admin/post-new.php?post_type=page" }
  ]
}
