{
  "preferredVersions": { "php": "8.2", "wp": "latest" },
  "steps": [
    { "step": "login", "username": "admin", "password": "password" },
    {
      "step": "writeFile",
      "path": "/wp-content/plugins/ai-patterns/ai-patterns.php",
      "data": "<?php\n/**\n * Plugin Name: AI Patterns\n */\nif(!defined('ABSPATH'))exit;\n\nadd_action('admin_enqueue_scripts', function(){\n  wp_enqueue_script('wp-api-fetch');\n  $nonce = wp_create_nonce('wp_rest');\n  $rest  = esc_url_raw(rest_url('ai-patterns/v1/create'));\n  $js = \"(function(){var endpoint='$rest';var nonce='$nonce';window.addEventListener('message',async function(ev){var d=ev.data||{};if(d.type!=='AI_PATTERNS_CREATE')return;try{await fetch(endpoint,{method:'POST',headers:{'Content-Type':'application/json','X-WP-Nonce':nonce},body:JSON.stringify(d.payload)});}catch(e){console.error(e);}});})();\";\n  wp_add_inline_script('wp-api-fetch',$js);\n});\n\nadd_action('rest_api_init', function(){\n  register_rest_route('ai-patterns/v1','/create',[\n    'methods'=>'POST',\n    'permission_callback'=>function(){return current_user_can('edit_posts');},\n    'args'=>['title'=>['type'=>'string','required'=>true],'content'=>['type'=>'string','required'=>true]],\n    'callback'=>function($req){\n      $title=sanitize_text_field($req['title']);\n      $content=$req['content'];\n      if(strpos($content,'<!-- wp:')===false){return new WP_REST_Response(['ok'=>false,'error'=>'invalid'],400);} \n      register_block_pattern_category('ai-patterns',['label'=>'AI Patterns']);\n      $slug='ai-pattern-'.wp_generate_password(8,false,false);\n      register_block_pattern($slug,['title'=>$title,'content'=>$content,'categories'=>['ai-patterns']]);\n      return ['ok'=>true,'slug'=>$slug];\n    }\n  ]);\n});"
    },
    { "step": "activatePlugin", "plugin": "ai-patterns/ai-patterns.php" },
    { "step": "installTheme", "themeZipFile": "https://downloads.wordpress.org/theme/twentytwentyfour.latest-stable.zip" },
    { "step": "activateTheme", "theme": "twentytwentyfour" },
    { "step": "navigate", "url": "/wp-admin/post-new.php?post_type=page" }
  ]
}
